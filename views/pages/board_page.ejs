<!DOCTYPE html>
<html lang="en">
<head>
    <title>Title</title>


    <% include ../partials/board_page %>
</head>
<body>

<!-- Sidebar -->
<div class="w3-sidebar w3-bar-block w3-card w3-animate-left" style="display:none" id="mySidebar">
    <button class="w3-bar-item w3-button w3-large"
            onclick="w3_close()">Close &times;</button>
    <a href="#" class="w3-bar-item w3-button">My Account</a>
    <a href="#" class="w3-bar-item w3-button">Setting</a>
    <a href="<%= log_out_link%>" class="w3-bar-item w3-button">Log Out</a>
</div>

<!-- Page Content -->
<div class="page" id = "main">
    <div id="header">
        <button style="float: left" id="openNav" class="w3-button w3-xlarge" onclick="w3_open()">&#9776;</button>
        <div >
            <h1 id = "company_name">HAPPY VIBES CO.</h1>
        </div>
    </div>

    <!-- NOTE MESSAGE BOARD -->
    <div id="postits_parent" class="postits">

        <div id="postHeader">
            OFFICE MESSAGE BOARD
        </div>
        <img class="add_note_buttons" src="/img/plusButton.png" onclick="open_new_note_overlay()">
        <div class = "droppable" id="postits">
            <!-- This is the div where post are generated -->
        </div>

    </div>

    <!-- EVENT BOARD -->
    <div id="events" class="events">
        <div id="eventHeader">
            UPCOMING EVENTS
        </div>

        <img  class="add_event_button" src="/img/addNoteButton.png" onclick="open_new_event_overlay()">
    </div>
</div>

<!-- NOTE SUBMIT OVERLAY -->
<div id="note_submit_overlay" class="overlay">
    <div id="newnote">
        <div class="sticky" id="typesticky">
            <div id="sticky_submit_text" class="sticky_text" class="editable" contenteditable="true">
            </div>
            <!-- Anonymous <input type="checkbox"> <br> -->
            <button type="button" id="post_button" onclick="create_postit()">Post It!</button>

        </div>
    </div>
</div>

<!-- Event SUBMIT OVERLAY -->
<div id="event_submit_overlay" class="overlay">
    <div id="new_event">
        <div>Event Name: <input id="event_name_box" type="text"><br>
            Location: <input id="location_box" type="text"><br>
            Date: <input id="date_box" type="date"><br>
            From: <input id="time_from_box" type="time"><br>
            Till: <input id="time_to_box" type="time"></div>
        <button type="button" id = "submit_button" onclick="create_event()">Submit</button>
    </div>
</div>

<script>

    let currentDroppable = null;

    typesticky.onmousedown = function (event) {

        let shiftX = event.clientX - typesticky.getBoundingClientRect().left;
        let shiftY = event.clientY - typesticky.getBoundingClientRect().top;

        typesticky.style.position = "absolute";
        typesticky.style.zIndex = 1000;
        document.body.append(typesticky);

        moveAt(event.pageX, event.pageY);

        function moveAt(pageX, pageY){
            typesticky.style.left = pageX - shiftX / 2 + "px";
            typesticky.style.top = pageY - shiftY / 2 + "px";
        };

        function onMouseMove(event){
            moveAt(event.pageX, event.pageY);
            typesticky.hidden = true;
            let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
            typesticky.hidden = false;

            if(!elemBelow){
                return;
            }
            let droppableBelow = elemBelow.closest(".droppable");

            if(currentDroppable != droppableBelow){
                if (currentDroppable){
                    leaveDroppable(currentDroppable);
                }
                currentDroppable = droppableBelow;
                if (currentDroppable){
                    enterDroppable(currentDroppable);
                }
            }
        }

        document.addEventListener("mousemove", onMouseMove);

        typesticky.onmouseup = function(){
            document.removeEventListener("mousemove", onMouseMove);
            typesticky.onmouseup = null;
        };

        typesticky.ondragstart = function(){
            return false;
        };
    };
</script>



</body>
</html>